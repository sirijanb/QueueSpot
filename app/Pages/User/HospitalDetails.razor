@using System.Web
@using app.Models

<div class="p-4 h-100 w-100 hospital-details">

    <div class="hospital-details-title tile">
        <div class="row">
            <div class="col-2 d-none d-lg-block">
                <img src="@(string.IsNullOrEmpty(Hospital.Photo) ? "/images/hospital_pic_example_grey.jpg" : Hospital.Photo)" class="hospital-pic rounded-circle w-100" alt="Hospital Image">
            </div>
            <div class="col-10 col-lg-8">
                <h3 class="fw-bold">
                    @Hospital.Name
                    <span class="close-ui d-none"><button class="close-button" @onclick="OnCloseButtonClick">×</button></span>
                </h3>
                <span class="addr"><i class="bi bi-pin-map-fill"></i> @Hospital.Address</span><br />
                <span class="badge bg-light text-dark mb-3">@Hospital.Status</span><br />
                <a href="@String.Format("https://www.google.com/maps/dir/?api=1&destination={0}", HttpUtility.UrlEncode(Hospital.Address))" target="_blank" class="btn btn-primary"><i class="bi bi-cursor-fill"></i> Direction</a>
                <button class="btn btn-outline-secondary" type="button" @onclick="OnCloseButtonClick"> Close</button>
            </div>
        </div>
        
    </div>

    <div class="container">
       <div class="row">
           <div class="col">
               <div class="tile">
               <p>Current ER Wait Time</p>
                    @if (int.Parse(Hospital.EstimatedWait) >= 60)
                    {
                        EstimatedWait = String.Format("{0}h {1}m", int.Parse(Hospital.EstimatedWait) / 60, int.Parse(Hospital.EstimatedWait) % 60);
                    }
                    else
                    {
                        EstimatedWait = String.Format("{0}m", int.Parse(Hospital.EstimatedWait));
                    }
                    <b class="h3">@EstimatedWait</b>
                </div>
           </div>
           
            @*<div class="col ">
                <div class="tile">
                    <p class="mb-2 fw-bold"><i class="bi bi-geo-alt"></i> Location</p>
                    <p class="mb-1 "><small>@Hospital.Address</small></p>
                     <button class="btn btn-sm btn-outline-primary mt-2" @onclick="OpenDirections">
                        <i class="bi bi-navigation"></i> Get Directions
                    </button> 
                </div>
            </div>
            *@

            <div class="col ">
                <div class="tile">
                <p>Available beds</p>
                    <b class="h3">@Hospital.BedsOpen</b> beds
                </div>
            </div>
        </div>

        <div class="col ">
            <div class="tile">
                <p class="fw-bold">Occupancy Status</p>
                <b>0%</b>
            </div>
        </div>

        <div class="col ">
            <div class="tile">
                <p class="fw-bold">Available beds</p>
                <b>@Hospital.BedsOpen</b> beds
            </div>
        </div>


    </div>

    <div class="container">
        <div class="row">
            <div class="col">
                <div class="tile">
                <h6 class="">Services</h6>
                @foreach (var service in Hospital.Services)
                {
                        <span class="badge bg-light text-dark me-1">@service</span>
                }
            </div>
        </div>
    </div>
</div>
<!-- Phone & Website -->
<div class="container mt-3">
    <div class="row">
        <div class="col-6">
            <div class="tile">
                <h6 class="mb-2"><i class="bi bi-telephone"></i> Contact</h6>
                <p class="mb-0"><small>@(string.IsNullOrEmpty(Hospital.PhoneNumber) ? "N/A" :
                                                Hospital.PhoneNumber)</small></p>
            </div>
        </div>
        <div class="col-6">
            <div class="tile">
                <h6 class="mb-2"><i class="bi bi-globe"></i> Website</h6>
                <p class="mb-0"><small>@(string.IsNullOrEmpty(Hospital.Website) ? "N/A" : Hospital.Website)</small></p>
            </div>
        </div>
    </div>
</div>
</div>

@code {
    @inject IJSRuntime JS

    [Parameter] public Hospital Hospital { get; set; } = default!;
    [Parameter] public EventCallback<MouseEventArgs> OnClickClose { get; set; }

    

    private string EstimatedWait = "";

    private Task OnCloseButtonClick(MouseEventArgs args)
    {
        return OnClickClose.InvokeAsync(args);
    }
    private async Task OpenDirections()
    {
        if (Hospital != null && !string.IsNullOrEmpty(Hospital.Address))
        {
            string mapsUrl = $"https://www.google.com/maps/search/{Uri.EscapeDataString(Hospital.Address)}";
            await JS.InvokeVoidAsync("open", mapsUrl, "_blank");
        }
    }

}