@page "/admin/hospitals"
@layout AdminLayout
@using BlazorBootstrap
@using Microsoft.AspNetCore.Components.Server.ProtectedBrowserStorage
@using app.Models
@inject NavigationManager Nav
@inject ProtectedSessionStorage Session

<h1>Hospital Management</h1>

<span class="float-end"><button class="btn btn-primary" type="button" @onclick="RegisterNewHospital">New Hospital</button></span>

<div class="admin-container">
    <div class="tile">
        <div class="tile-container">
                   
            <HospitalMgmtList Hospitals="hospitals" ></HospitalMgmtList>

            <Pagination TotalPages="100" ActivePageNumber="@ActivePageNumber" PageChanged="OnPageChangedAsync" />
        </div>
    </div>
</div>

@code {
    int ActivePageNumber = 1;

    List<Hospital> hospitals = new List<Hospital>();

    protected override void OnInitialized()
    {

        LoadPage(ActivePageNumber);

    }

    public async Task OnPageChangedAsync(int newPageNumber)
    {
        ActivePageNumber = newPageNumber;
        LoadPage(newPageNumber);
    }

    private void LoadPage(int page)
    {
        hospitals.Clear();
        for (int i = (page - 1) * 10; i < (page * 10) + 10; i++)
        {
            hospitals.Add(new Hospital()
            {
                Id = i,
                Name = "No name hospital " + i.ToString(),
                Photo = "/images/hospital_pic_example.jpg",
                Address = "555 Avenue Rd, Toronto, ON",
                Status = ""
            });
        }
    }

    private void RegisterNewHospital()
    {
        Nav.NavigateTo("/admin/hospitals/edit");   
    }
}